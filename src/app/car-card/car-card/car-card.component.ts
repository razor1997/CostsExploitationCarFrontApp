import { Component, OnInit } from '@angular/core';
import { CarsService } from 'src/app/_services/cars.service';
import { AccountService } from 'src/app/_services/account.service';
import { User } from 'src/app/_models/user';
import { take } from 'rxjs/operators';
import { Car } from 'src/app/_models/car';
import { ToastrService } from 'ngx-toastr';
import { Observable } from 'rxjs';
import { AudiMark, BMWMark, LexusMark, MarkEnum, MercedesMark } from 'src/app/_enums/cars-data';

@Component({
  selector: 'app-car-card',
  templateUrl: './car-card.component.html',
  styleUrls: ['./car-card.component.css'],
})
export class CarCardComponent implements OnInit {
  user: User;
  cars$: Observable <Car[]>; 
  car: Car;
  public Marks = MarkEnum;
  yearProduction:Number[];
  enumKeys = [];
  carModels:String[];

  constructor(private _accoutService: AccountService, private _carsService: CarsService, private _toastr: ToastrService) { 
    this._accoutService.currentUser$.pipe(take(1)).subscribe(user => this.user = user);
    this.enumKeys = Object.keys(this.Marks).filter(f => !isNaN(Number(f)));
    this.setYearProduction();
  }

  ngOnInit(): void {
    this.cars$ = this._carsService.getCars();
  }
  addUserCar(){
    this._carsService.addUserCar(this.car);
  }
  readUserCar(){
    this.cars$ = this._carsService.getCars();
  }
  deleteUserCar(id: Number){
    console.log("lalalalala");
    this._carsService.deleteUserCar(id);
  }
  onSelect(markEnum)
  {
    switch(+markEnum)
    {
      case MarkEnum.Audi: this.carModels = Object.keys(AudiMark).filter(key => isNaN(+key));        break;
      case MarkEnum.Mercedes: this.carModels = Object.keys(MercedesMark).filter(key => isNaN(+key));break;
      case MarkEnum.Lexus: this.carModels =  Object.keys(LexusMark).filter(key => isNaN(+key));     break;
      case MarkEnum.BMW: this.carModels =  Object.keys(BMWMark).filter(key => isNaN(+key));         break;

    }    
  }
  setYearProduction()
  {
    var currentYear = new Date().getFullYear();
    this.yearProduction= Array.from(Array(currentYear - 1979).keys()).map(x => x + 1980);
  }
}
