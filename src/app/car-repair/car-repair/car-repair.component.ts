import { Component, OnInit } from '@angular/core';
import { Observable } from 'rxjs';
import { take } from 'rxjs/operators';
import { RepairTypes } from 'src/app/_enums/cars-data';
import { CarRepair } from 'src/app/_models/car-repair';
import { User } from 'src/app/_models/user';
import { AccountService } from 'src/app/_services/account.service';
import { CarRepairService } from 'src/app/_services/car-repair.service';

@Component({
  selector: 'app-car-repair',
  templateUrl: './car-repair.component.html',
  styleUrls: ['./car-repair.component.css']
})
export class CarRepairComponent implements OnInit {
  user: User;
  carRepairs$: Observable<CarRepair[]>;
  repairs$: Observable<CarRepair[]>;
  repairTypes: string[] = [];

  constructor(private _accountService: AccountService, private _carRepairs: CarRepairService) { 
    this._accountService.currentUser$.pipe(take(1)).subscribe(user => this.user = user);
    this.repairTypes = RepairTypes;
  }

  ngOnInit(): void {

  }
  getAllRepairs(){
    this.repairs$ = this._carRepairs.getAllRepairs();
  }
  getCarRepairs(){
    this.carRepairs$ = this._carRepairs.getAllUserCarRepairs(this.user.username);
  }
  addCarRepair(){
    let type, description: String;
    let cost: Number;
    let carRepair: CarRepair;
    description = (<HTMLTextAreaElement>document.getElementById('description')).value;
    type =(<HTMLSelectElement>document.getElementById('typeRepair')).value;
    cost = parseInt((<HTMLInputElement>document.getElementById('costBuy')).value); 
    carRepair = {type: type, cost: cost, description: description}; 
    this._carRepairs.addCarRepair(carRepair);
  }
  deleteCarRepair()
  {

  }
}
